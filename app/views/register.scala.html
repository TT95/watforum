@(profileInConstruction: ProfileInConstruction)
@oauth = @{profileInConstruction!=null}
@import helper._
@main("Student form") {

  <link rel="stylesheet" type="text/css" href="@routes.Assets.at("stylesheets/register.css")" >
  @*validetta*@
  <script src="@routes.Assets.at("validetta/validetta.min.js")" type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="@routes.Assets.at("validetta/validetta.min.css")">

  @*bootstrap-fileinput*@
  <link href="@routes.Assets.at("bower_components/bootstrap-fileinput/css/fileinput.min.css")"
  media="all" rel="stylesheet" type="text/css" />
  <script src="@routes.Assets.at("bower_components/bootstrap-fileinput/js/plugins/canvas-to-blob.min.js")"
  type="text/javascript"></script>
  <script src="@routes.Assets.at("bower_components/bootstrap-fileinput/js/fileinput.min.js")"></script>

  <div id="kv-avatar-errors-1" class="alert alert-success text-center"></div>
  <div class="window">
    <div class="row">
      <h2>Register</h2>
    </div>
    <div class="row">
        <form action="@routes.SWTUserController.saveUser()" method="post" id="register_form">
      <div class="col-md-5">
          <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" class="form-control" name="username" id="username"
            data-validetta="required,remote[check_username],regExp[check_username],minLength[3],maxLength[15]">
          </div>
          @if(oauth==false) {
            <div class="form-group">
              <label for="password">Password:</label>
              <input type="password" class="form-control" name="password" id="password" data-validetta="required">
            </div>
            <div class="form-group">
              <label for="rpassword">Repeat password:</label>
              <input type="password" class="form-control" name="rpassword" id="rpassword"
              data-validetta="required,equalTo[password]">
            </div>
          }
          <div class="form-group">
            <label for="email">Email:</label>
            <input type="text" class="form-control" name="email" id="email"
            data-validetta="required,email,remote[check_email]"
              @if(oauth){value="@profileInConstruction.user.email"}>
          </div>
          <div class="form-group">
            <label for="firstName">First name:</label>
            <input type="text" class="form-control" name="firstName" id="firstName" data-validetta=""
              @if(oauth){value="@profileInConstruction.user.firstName"}>
          </div>
          <div class="form-group">
            <label for="lastName">Last name:</label>
            <input type="text" class="form-control" name="lastName" id="lastName" data-validetta=""
              @if(oauth){value="@profileInConstruction.user.lastName"}>
          </div>
          <div class="form-group">
            <label for="contact">Contact:</label>
            <input type="text" class="form-control" name="contact" id="contact" data-validetta=""
            @if(oauth){value="@profileInConstruction.user.contacts.get(0)"}>
          </div>

          @if(profileInConstruction != null) {
            <input type="hidden" name="client" id="client" value="@profileInConstruction.client.toString" >
            <input type="hidden" name="oauthId" id="oauthId" value="@profileInConstruction.oauthId" >
            <input type="hidden" name="profilePicture" id="profilePicture" value="@profileInConstruction.user." >
          }
          <button type="submit">Rate</button>
      </div>
          <div class="col-md-5">
            @*bootstrap-fileinput*@
              <!-- the avatar markup -->
            @*<form class="text-center" action="/avatar_upload.php" method="post" enctype="multipart/form-data">*@
              <div class="kv-avatar center-block" style="width:200px">
                <input id="avatar" name="avatar" type="file" class="file-loading">
              </div>
                <!-- include other inputs if needed and include a form submit (save) button -->
            @*</form>*@
          </div>
        </form>
    </div>
  </div>

    <!-- the fileinput plugin initialization -->
  <script>
          var btnCust = '<button type="button" class="btn btn-default" title="Add picture tags" ' +
                  'onclick="alert(\'Call your custom code here.\')">' +
                  '<i class="glyphicon glyphicon-tag"></i>' +
                  '</button>';
          $("#avatar").fileinput({
            overwriteInitial: true,
            maxFileSize: 1500,
            showClose: false,
            showCaption: false,
            browseLabel: '',
            removeLabel: '',
            browseIcon: '<i class="glyphicon glyphicon-folder-open"></i>',
            removeIcon: '<i class="glyphicon glyphicon-remove"></i>',
            removeTitle: 'Cancel or reset changes',
            elErrorContainer: '#kv-avatar-errors-1',
            msgErrorClass: 'alert alert-block alert-danger',
            defaultPreviewContent:
                    @if(oauth) {
                    '<img src="@profileInConstruction.user.profilePictureUrl" alt="Your Avatar" style="width:160px">',
            } else {
            '<img src="@routes.Assets.at("images/profiles/user-default.png")" alt="Your Avatar" style="width:160px">',
            }
            layoutTemplates: {main2: '{preview} ' +  btnCust + ' {remove} {browse}'},
            allowedFileExtensions: ["jpg", "png"]
          });
  </script>

  <script>
          $("#register_form").validetta({
            realTime: true,
            display : 'inline',
            errorTemplateClass : 'validetta-inline',
            validators: {
              remote : {
                check_username : {
                  type : 'POST',
                  url : '@routes.SWTUserController.checkUsername()',
                  datatype : 'json'
                },
                check_email : {
                  type : 'POST',
                  url : '@routes.SWTUserController.checkEmail()',
                  datatype : 'json'
                }
              },
              regExp : {
                check_username : {
                  pattern : /^[a-zA-Z0-9]+$/,
                  errorMessage : 'Only letters, numbers, underscore and dash available (3-15 characters)'
                }
              }
            }
          });
  </script>
}